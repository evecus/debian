{{define "dir.html"}}<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{if .Path}}{{.Path}}{{else}}Files{{end}} ‚Äî FileServer</title>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: #f6f8fa;
    color: #1f2328;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
    font-size: 14px;
    min-height: 100vh;
  }

  /* Header */
  .header {
    background: #ffffff;
    border-bottom: 1px solid #d0d7de;
    padding: 12px 24px;
    display: flex;
    align-items: center;
    gap: 12px;
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .logo {
    font-size: 15px;
    font-weight: 600;
    color: #1f2328;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .logo svg {
    color: #6e40c9;
  }

  .last-sync {
    margin-left: auto;
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    color: #57606a;
  }

  .last-sync .dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #1a7f37;
    flex-shrink: 0;
  }

  .last-sync .dot.unknown {
    background: #8c959f;
  }

  /* Container */
  .container {
    max-width: 1012px;
    margin: 0 auto;
    padding: 24px 16px;
  }

  /* Breadcrumb */
  .breadcrumb {
    display: flex;
    align-items: center;
    gap: 4px;
    margin-bottom: 16px;
    font-size: 14px;
    flex-wrap: wrap;
    color: #57606a;
  }

  .breadcrumb a {
    color: #0969da;
    text-decoration: none;
    font-weight: 600;
  }
  .breadcrumb a:hover { text-decoration: underline; }

  .breadcrumb .sep { color: #57606a; margin: 0 2px; }
  .breadcrumb .current { color: #1f2328; font-weight: 600; }

  /* File box */
  .file-box {
    background: #ffffff;
    border: 1px solid #d0d7de;
    border-radius: 6px;
    overflow: hidden;
  }

  .file-box-header {
    padding: 10px 16px;
    background: #f6f8fa;
    border-bottom: 1px solid #d0d7de;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    color: #57606a;
  }

  /* Rows */
  .file-row, .parent-row {
    display: grid;
    grid-template-columns: 20px 1fr 90px 140px;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    border-bottom: 1px solid #d8dee4;
    text-decoration: none;
    color: inherit;
    transition: background 0.1s;
  }

  .file-row:last-child, .parent-row:last-child { border-bottom: none; }
  .file-row:hover { background: #f6f8fa; }
  .parent-row:hover { background: #f6f8fa; }

  /* Icons */
  .file-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    color: #57606a;
    flex-shrink: 0;
  }

  .file-icon.dir { color: #54aeff; }

  /* Name */
  .file-name {
    font-size: 14px;
    color: #1f2328;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .file-name.dir {
    color: #1f2328;
    font-weight: 500;
  }

  .file-row:hover .file-name { color: #0969da; }
  .parent-row .file-name { color: #57606a; }

  /* Meta */
  .file-size {
    font-size: 12px;
    color: #57606a;
    text-align: right;
    white-space: nowrap;
  }

  .file-time {
    font-size: 12px;
    color: #57606a;
    text-align: right;
    white-space: nowrap;
  }

  /* Empty */
  .empty {
    text-align: center;
    padding: 48px 24px;
    color: #57606a;
  }
  .empty-icon { font-size: 40px; margin-bottom: 12px; }
  .empty-text { font-size: 14px; }

  @media (max-width: 600px) {
    .file-row, .parent-row { grid-template-columns: 20px 1fr auto; }
    .file-time { display: none; }
    .container { padding: 16px 12px; }
  }
</style>
</head>
<body>

<header class="header">
  <a href="/" class="logo">
    <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
      <path d="M2 2.5A2.5 2.5 0 0 1 4.5 0h8.75a.75.75 0 0 1 .75.75v12.5a.75.75 0 0 1-.75.75h-2.5a.75.75 0 0 1 0-1.5h1.75v-2h-8a1 1 0 0 0-.714 1.7.75.75 0 1 1-1.072 1.05A2.495 2.495 0 0 1 2 11.5Zm10.5-1h-8a1 1 0 0 0-1 1v6.708A2.486 2.486 0 0 1 4.5 9h8Z"/>
    </svg>
    FileServer
  </a>
  <div class="last-sync" id="lastSync">
    <span class="dot unknown" id="syncDot"></span>
    <span id="syncTime">-</span>
  </div>
</header>

<script>
  fetch('/__last_update__')
    .then(r => r.text())
    .then(t => {
      const dot = document.getElementById('syncDot');
      const el = document.getElementById('syncTime');
      if (t) {
        dot.classList.remove('unknown');
        el.textContent = 'ÊúÄÂêéÂêåÊ≠•Ôºö' + t;
      } else {
        el.textContent = 'Êú™ÂêåÊ≠•';
      }
    })
    .catch(() => {
      document.getElementById('syncTime').textContent = 'Êú™ÂêåÊ≠•';
    });
</script>

<main class="container">

  <nav class="breadcrumb">
    {{range $i, $p := .Parts}}
      {{if $i}}<span class="sep">/</span>{{end}}
      {{if eq $i (add (len $.Parts) -1)}}
        <span class="current">{{$p.Name}}</span>
      {{else}}
        <a href="{{$p.Path}}">{{$p.Name}}</a>
      {{end}}
    {{end}}
  </nav>

  <div class="file-box">
    <div class="file-box-header">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="color:#57606a">
        <path d="M1.75 1h8.5c.966 0 1.75.784 1.75 1.75v5.5A1.75 1.75 0 0 1 10.25 10H7.06l-2.573 2.573A1.458 1.458 0 0 1 2 11.543V10h-.25A1.75 1.75 0 0 1 0 8.25v-5.5C0 1.784.784 1 1.75 1ZM1.5 2.75v5.5c0 .138.112.25.25.25h1a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h3.5a.25.25 0 0 0 .25-.25v-5.5a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13 2a.25.25 0 0 0-.25-.25h-.5a.75.75 0 0 1 0-1.5h.5c.966 0 1.75.784 1.75 1.75v5.5A1.75 1.75 0 0 1 14.25 12H14v1.543a1.458 1.458 0 0 1-2.487 1.03L9.22 12.28a.749.749 0 0 1 .326-1.275.749.749 0 0 1 .734.215l2.22 2.22v-2.19a.75.75 0 0 1 .75-.75h.25a.25.25 0 0 0 .25-.25v-5.5Z"/>
      </svg>
      {{len .Files}} items
    </div>

    {{if .Path}}
    <a class="parent-row" href="../">
      <span class="file-icon">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
          <path d="M3.72 3.72a.75.75 0 0 1 1.06 1.06L2.56 7h10.69l-2.22-2.22a.75.75 0 1 1 1.06-1.06l3.5 3.5a.75.75 0 0 1 0 1.06l-3.5 3.5a.75.75 0 1 1-1.06-1.06L13.25 9H2.56l2.22 2.22a.75.75 0 1 1-1.06 1.06l-3.5-3.5a.75.75 0 0 1 0-1.06l3.5-3.5Z" transform="rotate(90 8 8)"/>
        </svg>
      </span>
      <span class="file-name">..</span>
      <span></span>
      <span></span>
    </a>
    {{end}}

    {{if .Files}}
      {{range .Files}}
      <a class="file-row" href="{{.Path}}">
        <span class="file-icon {{if .IsDir}}dir{{end}}">
          {{if .IsDir}}
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M1.75 1A1.75 1.75 0 0 0 0 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75 0 0 0 16 13.25v-8.5A1.75 1.75 0 0 0 14.25 3H7.5a.25.25 0 0 1-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75Z"/>
          </svg>
          {{else}}
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0 1 13.25 16h-9.5A1.75 1.75 0 0 1 2 14.25Zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25h9.5a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 9 4.25V1.5Zm6.75.062V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914-.013-.011Z"/>
          </svg>
          {{end}}
        </span>
        <span class="file-name {{if .IsDir}}dir{{end}}">{{.Name}}</span>
        <span class="file-size">{{if not .IsDir}}{{formatSize .Size}}{{end}}</span>
        <span class="file-time">{{formatTime .ModTime}}</span>
      </a>
      {{end}}
    {{else}}
    <div class="empty">
      <div class="empty-icon">üìÇ</div>
      <div class="empty-text">This folder is empty</div>
    </div>
    {{end}}
  </div>

</main>
</body>
</html>{{end}}
